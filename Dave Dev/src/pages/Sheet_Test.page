<!--
    demo page for jquery.sheet
    as simple a piece of code as I can muster to establish spreadsheet inline
    first step in getting a page setup to provide browser based sforce excel connector functionality.

-->

<apex:page showChat="false" showHeader="false" sidebar="false" controller="jQuerySheetController" id="thePage" standardStylesheets="false"> <!--   tabstyle="Workbook__c">-->
    <apex:includeScript value="{!URLFOR($Resource.Sheet, 'jquery-1.5.2.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.Sheet, 'jquery-ui/ui/jquery-ui.min.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.Sheet, 'jquery.sheet.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.Sheet, 'parser.js')}"/>
    
    <apex:stylesheet value="{!URLFOR($Resource.Sheet, 'jquery.sheet.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.Sheet, 'jquery-ui/theme/jquery-ui.css')}"/>

    <head>

    <script>
        var startLoading = function() {
        // add the overlay with loading image to the page
        var over = '<div id="overlay" >' +
            '<img id="loading" src="{!URLFOR($Resource.WaitIcons, 'wait30.gif')}">' +
            '</div>';
            
            $(over).appendTo('body');
            $(over).focus();
        };
        
        var stopLoading = function() {
        // remove the overlay
            $('#overlay').click(function() {
                $(this).remove();
            });
        };
       
       $(document).ready(function() {
            
            var accName = '{!accName}';
            var accID = '{!accID}';
            var wbName = '{!wbName}';
            var wbID = '{!wbID}';
            //var XMLString = '[{"metadata":{"columns":15,"rows":41,"title":"SPOT 1","col_widths":{"c0":"120","c1":"120","c2":"120","c3":"120","c4":"120","c5":"120","c6":"120","c7":"120","c8":"120","c9":"120","c10":"120","c11":"120","c12":"120","c13":"120","c14":"120"}},"data":{"r0":{"h":"18","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r1":{"h":"18px","c0":{"value":"Client","style":"undefined","colspan":null,"cl":""},"c1":{"value":"0","style":"display: table-cell; ","colspan":4,"cl":""},"c2":{"value":"","style":"display: none; ","colspan":null,"cl":""},"c3":{"value":"","style":"display: none; ","colspan":null,"cl":""},"c4":{"value":"","style":"display: none; ","colspan":null,"cl":""},"c5":{"value":"JOY Rep","style":"undefined","colspan":null,"cl":""},"c6":{"value":"Phillippe Cahill","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"Campaign Start Date","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"1-Jan-04","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r2":{"h":"18px","c0":{"value":"On-air name","style":"undefined","colspan":null,"cl":""},"c1":{"value":"0","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"Contact","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0412 427 943","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"Campaign End Date","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"1-Jan-04","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r3":{"h":"18px","c0":{"value":"Slot","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Type","style":"undefined","colspan":null,"cl":""},"c2":{"value":"Monday","style":"undefined","colspan":null,"cl":""},"c3":{"value":"Tuesday","style":"undefined","colspan":null,"cl":""},"c4":{"value":"Wednesday","style":"undefined","colspan":null,"cl":""},"c5":{"value":"Thursday","style":"undefined","colspan":null,"cl":""},"c6":{"value":"Friday","style":"undefined","colspan":null,"cl":""},"c7":{"value":"Subtotal","style":"undefined","colspan":null,"cl":""},"c8":{"value":"Saturday","style":"undefined","colspan":null,"cl":""},"c9":{"value":"Sunday","style":"undefined","colspan":null,"cl":""},"c10":{"value":"Subtotal","style":"undefined","colspan":null,"cl":""},"c11":{"value":"Total","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r4":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r5":{"h":"18px","c0":{"value":"Breakfast","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r6":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r7":{"h":"18px","c0":{"value":"Morning","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r8":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r9":{"h":"18px","c0":{"value":"Afternoon","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r10":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r11":{"h":"18px","c0":{"value":"Drive","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r12":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r13":{"h":"18px","c0":{"value":"Evening","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r14":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r15":{"h":"18px","c0":{"value":"Late Evening","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r16":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r17":{"h":"18px","c0":{"value":"Total","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c2":{"value":"0","style":"undefined","colspan":null,"cl":""},"c3":{"value":"0","style":"undefined","colspan":null,"cl":""},"c4":{"value":"0","style":"undefined","colspan":null,"cl":""},"c5":{"value":"0","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"0","style":"undefined","colspan":null,"cl":""},"c9":{"value":"0","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r18":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c2":{"value":"0","style":"undefined","colspan":null,"cl":""},"c3":{"value":"0","style":"undefined","colspan":null,"cl":""},"c4":{"value":"0","style":"undefined","colspan":null,"cl":""},"c5":{"value":"0","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"0","style":"undefined","colspan":null,"cl":""},"c9":{"value":"0","style":"undefined","colspan":null,"cl":""},"c10":{"value":"0","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r19":{"h":"18px","c0":{"value":"GRAND TOTAL","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"0","style":"undefined","colspan":null,"cl":""},"c3":{"value":"0","style":"undefined","colspan":null,"cl":""},"c4":{"value":"0","style":"undefined","colspan":null,"cl":""},"c5":{"value":"0","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"0","style":"undefined","colspan":null,"cl":""},"c9":{"value":"0","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"0","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r20":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r21":{"h":"18px","c0":{"value":"Sheet Start Date","style":"undefined","colspan":null,"cl":""},"c1":{"value":"insert date","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"Sheet END Date","style":"undefined","colspan":null,"cl":""},"c4":{"value":"insert date","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"Total No. of weeks for this sheet","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"0","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r22":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r23":{"h":"18px","c0":{"value":"TYPE","style":"undefined","colspan":null,"cl":""},"c1":{"value":"THIS SHEET","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"TOTALS","style":"undefined","colspan":null,"cl":""},"c7":{"value":" GRAND","style":"undefined","colspan":null,"cl":""},"c8":{"value":"Spots are ","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"30","style":"undefined","colspan":null,"cl":""},"c11":{"value":"SECS","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r24":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r25":{"h":"18px","c0":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Peak","style":"undefined","colspan":null,"cl":""},"c2":{"value":"Daytime","style":"undefined","colspan":null,"cl":""},"c3":{"value":"Evening","style":"undefined","colspan":null,"cl":""},"c4":{"value":"Late Evening","style":"undefined","colspan":null,"cl":""},"c5":{"value":"Weekend","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"Notes:","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r26":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"0","style":"undefined","colspan":null,"cl":""},"c2":{"value":"0","style":"undefined","colspan":null,"cl":""},"c3":{"value":"0","style":"undefined","colspan":null,"cl":""},"c4":{"value":"0","style":"undefined","colspan":null,"cl":""},"c5":{"value":"0","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r27":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r28":{"h":"18px","c0":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Peak","style":"undefined","colspan":null,"cl":""},"c2":{"value":"Daytime","style":"undefined","colspan":null,"cl":""},"c3":{"value":"Evening","style":"undefined","colspan":null,"cl":""},"c4":{"value":"Late Evening","style":"undefined","colspan":null,"cl":""},"c5":{"value":"Weekend","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r29":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"0","style":"undefined","colspan":null,"cl":""},"c2":{"value":"0","style":"undefined","colspan":null,"cl":""},"c3":{"value":"0","style":"undefined","colspan":null,"cl":""},"c4":{"value":"0","style":"undefined","colspan":null,"cl":""},"c5":{"value":"0","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r30":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r31":{"h":"18px","c0":{"value":"TYPE","style":"undefined","colspan":null,"cl":""},"c1":{"value":"ALL SHEETS (includes this sheet multiplied by the No. of weeks)","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"TOTALS","style":"undefined","colspan":null,"cl":""},"c7":{"value":" GRAND","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r32":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r33":{"h":"18px","c0":{"value":"Paid","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Peak","style":"undefined","colspan":null,"cl":""},"c2":{"value":"Daytime","style":"undefined","colspan":null,"cl":""},"c3":{"value":"Evening","style":"undefined","colspan":null,"cl":""},"c4":{"value":"Late Evening","style":"undefined","colspan":null,"cl":""},"c5":{"value":"Weekend","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0","style":"undefined","colspan":null,"cl":""},"c7":{"value":"0","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r34":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"0","style":"undefined","colspan":null,"cl":""},"c2":{"value":"0","style":"undefined","colspan":null,"cl":""},"c3":{"value":"0","style":"undefined","colspan":null,"cl":""},"c4":{"value":"0","style":"undefined","colspan":null,"cl":""},"c5":{"value":"0","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r35":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r36":{"h":"18px","c0":{"value":"Bonus","style":"undefined","colspan":null,"cl":""},"c1":{"value":"Peak","style":"undefined","colspan":null,"cl":""},"c2":{"value":"Daytime","style":"undefined","colspan":null,"cl":""},"c3":{"value":"Evening","style":"undefined","colspan":null,"cl":""},"c4":{"value":"Late Evening","style":"undefined","colspan":null,"cl":""},"c5":{"value":"Weekend","style":"undefined","colspan":null,"cl":""},"c6":{"value":"0","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r37":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"0","style":"undefined","colspan":null,"cl":""},"c2":{"value":"0","style":"undefined","colspan":null,"cl":""},"c3":{"value":"0","style":"undefined","colspan":null,"cl":""},"c4":{"value":"0","style":"undefined","colspan":null,"cl":""},"c5":{"value":"0","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r38":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r39":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}},"r40":{"h":"18px","c0":{"value":"","style":"undefined","colspan":null,"cl":""},"c1":{"value":"","style":"undefined","colspan":null,"cl":""},"c2":{"value":"","style":"undefined","colspan":null,"cl":""},"c3":{"value":"","style":"undefined","colspan":null,"cl":""},"c4":{"value":"","style":"undefined","colspan":null,"cl":""},"c5":{"value":"","style":"undefined","colspan":null,"cl":""},"c6":{"value":"","style":"undefined","colspan":null,"cl":""},"c7":{"value":"","style":"undefined","colspan":null,"cl":""},"c8":{"value":"","style":"undefined","colspan":null,"cl":""},"c9":{"value":"","style":"undefined","colspan":null,"cl":""},"c10":{"value":"","style":"undefined","colspan":null,"cl":""},"c11":{"value":"","style":"undefined","colspan":null,"cl":""},"c12":{"value":"","style":"undefined","colspan":null,"cl":""},"c13":{"value":"","style":"undefined","colspan":null,"cl":""},"c14":{"value":"","style":"undefined","colspan":null,"cl":""}}}}]';
            var XMLString = '{!strXML}';
            
            console.log('return: ' + XMLString);
            $('#jQuerySheet').sheet({
                     //title: accName + ' - ' + wbName,
                     //buildSheet: '13x40', //c x r
                     //buildSheet: (XMLString == '')?'15x40':jQuery.sheet.makeTable.json(XMLString,true),
                     buildSheet: (XMLString == '')?'15x40':jQuery.sheet.makeTable.xml(XMLString),
                     editable: true,
                     calcOff: false,
                     fnSaveAs: function(){
                        
                        var newName = prompt('Please enter workbook name');
                        if (newName) {
                            //var sht = $('[id$=jQuerySheet]').getSheet(); // get the sheet
                            //var mydata = sht.exportSheet.json();
                            //console.log('Send: ' + JSON.stringify(mydata));
                            //Check that the account doesn't already have a workbook by this name
                            jQuerySheetController.workbookExists(accID, newName, function(result,event){
                                if(result=='TRUE') {
                                    var replace = confirm(newName + 'already exists, do you want to replace it?');
                                    if(replace == true) {
                                     startLoading();
                                     var sht = $('[id$=jQuerySheet]').getSheet(); // get the sheet
                                     var mydata = sht.exportSheet.xml(true);
                                     //var mydata = sht.exportSheet.json();
                                     //jQuerySheetController.saveWorkbook(accID,wbID,newName,JSON.stringify(mydata) ,function(result,event){
                                     jQuerySheetController.saveWorkbook(accID,wbID,newName,mydata ,function(result,event){
                                         if(result != 'ERROR'){
                                            location.replace(window.location.hostname + '/apex/sheet_test?aid=' + accID + '&wid=' + result);
                                            //alert('Workbook Saved');
                                            
                                        } else {
                                            alert('Error: Workbook not saved');
                                            
                                        }
                                    });
                                    stopLoading();
                                    }
                                }
                                
                                else {
                                    //Workbook Name is unique for Account
                                     startLoading();
                                     var sht = $('[id$=jQuerySheet]').getSheet(); // get the sheet
                                     //var mydata = sht.exportSheet.json();
                                     var mydata = sht.exportSheet.xml(true);
                                     //console.log('Send: ' + JSON.stringify(mydata));
                                     jQuerySheetController.saveWorkbook(accID,wbID,newName,mydata ,function(result,event){
                                     //jQuerySheetController.saveWorkbook(accID,wbID,newName,JSON.stringify(mydata) ,function(result,event){
                                     if(result != 'ERROR'){
                                            location.replace(window.location.hostname + '/apex/sheet_test?aid=' + accID + '&wid=' + result);
                                            //alert('Workbook Saved');
                                              
                                          } else {
                                              alert('Error: Workbook not saved');
                                              
                                          }
                                      });
                                    stopLoading();  
                                }
                            });
                            
                        }                       
                     },
                     fnSave: function() { 
                         //Prompt for a name if the workbook is new
                         //console.log('Send: ' + JSON.stringify(mydata));
                         
                         if (wbID == '') {
                            var newName = prompt('Please enter workbook name');
                            if (newName) {
                                //Check that the account doesn't already have a workbook by this name
                                
                                jQuerySheetController.workbookExists(accID, newName, function(result,event){
                                    if(result=='TRUE') {
                                        var replace = confirm(newName + 'already exists, do you want to replace it?');
                                        if(replace == true) {
                                             startLoading();
                                             var sht = $('[id$=jQuerySheet]').getSheet(); // get the sheet
                                             var mydata = sht.exportSheet.xml(true);
                                             //var mydata = sht.exportSheet.json();
                                             //jQuerySheetController.saveWorkbook(accID,wbID,newName,JSON.stringify(mydata) ,function(result,event){
                                             jQuerySheetController.saveWorkbook(accID,wbID,newName,mydata ,function(result,event){
                                                 if(result != 'ERROR'){
                                                    location.replace(window.location.hostname + '/apex/sheet_test?aid=' + accID + '&wid=' + result);
                                                    //event.id = result;
                                                    //alert('Workbook Saved');
                                                    
                                                } else {
                                                    alert('Error: Workbook not saved');
                                                    
                                                }
                                            });
                                            stopLoading();
                                        }
                                    }
                                    
                                    else {
                                            //Existing workbook so overwrite
                                             startLoading();
                                             var sht = $('[id$=jQuerySheet]').getSheet(); // get the sheet
                                             //var mydata = sht.exportSheet.json();
                                             var mydata = sht.exportSheet.xml(true);
                                             //jQuerySheetController.saveWorkbook(accID,wbID,newName,JSON.stringify(mydata) ,function(result,event){
                                             jQuerySheetController.saveWorkbook(accID,wbID,newName,mydata ,function(result,event){
                                             if(result != 'ERROR'){
                                                 location.replace(window.location.hostname + '/apex/sheet_test?aid=' + accID + '&wid=' + result);
                                                    //event.id = result;
                                                    //alert('Workbook Saved');
                                                       
                                                   } else {
                                                       alert('Error: Workbook not saved');
                                                       
                                                   }
                                              });
                                            stopLoading();  
                                        }
                                });
                            }
                         }
                         else {
                            //Existing workbook so overwrite
                             startLoading();
                             var sht = $('[id$=jQuerySheet]').getSheet(); // get the sheet
                             var mydata = sht.exportSheet.xml(true);
                             //var mydata = sht.exportSheet.json();
                             //console.log('Send: ' + JSON.stringify(mydata));
                             //alert('accid: ' + accID + ' /wbID: ' + wbID + ' /wbName: ' + wbName + ' /JSON: ' + JSON.stringify(mydata));
                             jQuerySheetController.saveWorkbook(accID,wbID,wbName,mydata ,function(result,event){
                             //jQuerySheetController.saveWorkbook(accID,wbID,wbName,JSON.stringify(mydata) ,function(result,event){
                             //alert(result);
                             if(result != 'ERROR'){
                                 location.replace(window.location.hostname + '/apex/sheet_test?aid=' + accID + '&wid=' + result);
                                //event.id = result;
                                //alert('Workbook Saved');
                                      
                                  } else {
                                      alert('Error: Workbook not saved');
                                      
                                  }
                              });
                           stopLoading();   
                        }
                    },
                     fnSync: function() {
                        var sht = $('[id$=jQuerySheet]').getSheet();
                        var cellTD = $('[id$=jQuerySheet]').getSheet().obj.cellActive();
                        var cellRef = $('[id$=jQuerySheet]').getSheet().getTdLocation(cellTD);
                        var sheetTab =  $('[id$=jQuerySheet]').getSheet().sheetTab(true);
                        var cellValue = $('[id$=jQuerySheet]').getCellValue(cellRef.row,cellRef.col,sht.i);
                        //alert('wbID: ' + wbID + '\nSheet: ' + sheetTab + '\nRow: ' + cellRef.row + '\nCol: ' + cellRef.col + '\nCell Value: ' + cellValue);
                        jQuerySheetController.saveSyncReference(wbID, sheetTab, cellRef.row, cellRef.col, cellValue,function(result, event){
                            alert(result);
                        });
                        
                        //alert('Sheet: ' + sheetTab + '\nRow: ' + cellRef.row + '\nCol: ' + cellRef.col + '\nCell Text: ' + cellValue);
                        $('[id$=jQuerySheet]').getSheet().themeRoller.cell.setSynced(cellTD);
                    },
                     /*
                     fnOpen: function() { 
                        
                        jQuerySheetController.getWorkbook(wbID, function(result,event){
                        
                        var n = result.replace(/&(lt|gt|quot);/g, function (m, p) { 
                              
                            return (p == "lt") ? "<" : ((p == "gt") ? ">" : "'");
                          });
                        
                         $('#jQuerySheet').sheet({ 
                            buildSheet: (wbID=='') ? '10x15' : jQuery.sheet.makeTable.xml(n,true) 
                          }); 
                        
                     });
                    }
                    */ 
              });
              
                $('#print').click(function() {
                  var sht = $('[id$=jQuerySheet]').getSheet(); // get the sheet
                  var mydata = sht.exportSheet.xml(true);
                  //sheetInstance.exportSheet.xml(true)
                  //var mydata = sht.viewSource(true)
                  //var html = '<html><body>' + mydata.html() + '</body></html>'
                  //jQuerySheetController.printSheet(wbID,html,function(result,event){
                  //    alert(result);
                  //});
                  //console.log(html);
                  alert(mydata);
              });
         
         });
    
        
        //This function builds the inline menu to make it easy to interact with each sheet instance
            function inlineMenu(I){
                I = (I ? I.length : 0);
                
                //we want to be able to edit the html for the menu to make them multi-instance
                var html = $('[id$=inlineMenu]').html().replace(/sheetInstance/g, "$.sheet.instance[" + I + "]");
                
                var menu = $(html);
                
                
                
                return menu;
            }
            
          

        
        
    </script>
    <style type='text/css'>

    #overlay {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
        background: #000;
        opacity: 0.8;
        filter: alpha(opacity=80);
        z-index:1000;
    }
    #loading {
        width: 30px;
        height: 30px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin: -28px 0 0 -25px;
    }

    </style>
    
</head>    
<body>

<apex:sectionHeader subtitle="Inline Spreadsheet:{!wbName}" title="{!accName}"/>

<table width="95%" id="theTable">
    <tr>
        
        <td id="theSheet">
            <div id="jQuerySheet"></div>
        </td>
    </tr>
</table>
{!heapsize}
<table>
<tr>
    <td align="center">
        <apex:form id="theForm" >
            <apex:commandbutton value="Cancel" action="{!cancel}" />
            
        </apex:form>
        
    </td>
    <td align="center">
        <button id="print">Print</button>
    </td> 
</tr>
</table>


</body>
</apex:page>